# ุญู ูุดููุฉ 413 Request Entity Too Large

## ๐ ูุตู ุงููุดููุฉ
ุฎุทุฃ 413 "Request Entity Too Large" ูุญุฏุซ ุนูุฏ ูุญุงููุฉ ุฑูุน ุตูุฑ ูุจูุฑุฉ ุฅูู ุงูุฎุงุฏู. ูุฐุง ุงูุฎุทุฃ ูุญุฏุซ ุนุงุฏุฉ ุจุณุจุจ:

1. **ุฅุนุฏุงุฏุงุช nginx** ุชุฑูุถ ุงููููุงุช ุงููุจูุฑุฉ
2. **ุญุฏูุฏ Express.js** ุตุบูุฑุฉ ุฌุฏุงู
3. **ุนุฏู ุถุบุท ุงูุตูุฑ** ูู ุงูุนููู

## โ ุงูุญููู ุงููุทุจูุฉ

### 1. ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ุงูุฎุงุฏู

#### server.js
- ุฒูุงุฏุฉ `express.json()` limit ุฅูู 20MB
- ุฒูุงุฏุฉ `express.urlencoded()` limit ุฅูู 20MB  
- ุฒูุงุฏุฉ `multer` fileSize limit ุฅูู 10MB

#### middleware/upload.js
- ุฒูุงุฏุฉ fileSize limit ุฅูู 10MB

#### routes/upload.js
- ุฒูุงุฏุฉ fileSize limit ุฅูู 10MB
- ุชุญุฏูุซ ุฑุณุงุฆู ุงูุฎุทุฃ

### 2. ุฅุถุงูุฉ ุถุบุท ุงูุตูุฑ ูู ุงูุนููู

#### client/src/utils/imageUtils.js
- ุฅุถุงูุฉ ุฏุงูุฉ `compressImage()` ูุถุบุท ุงูุตูุฑ
- ุชุญุฏูุซ `uploadImageToGridFS()` ูุถุบุท ุงูุตูุฑ ุชููุงุฆูุงู
- ุถุบุท ุงูุตูุฑ ุฃูุจุฑ ูู 1MB ุฅูู 1920px ูุญุฏ ุฃูุตู
- ุถุบุท ุงูุฌูุฏุฉ ุฅูู 80%

### 3. ุฅุนุฏุงุฏุงุช nginx ููุฅูุชุงุฌ

#### server/nginx.conf
- `client_max_body_size 20M`
- `client_body_timeout 60s`
- `proxy_request_buffering off`
- `proxy_buffering off`
- ุฅุนุฏุงุฏุงุช timeout ุฃุทูู ููุฑูุน

## ๐ ููููุฉ ุงูุชุทุจูู

### ูู ุจูุฆุฉ ุงูุชุทููุฑ:
```bash
# ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู
npm restart
# ุฃู
pm2 restart lms-server
```

### ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ:
```bash
# 1. ูุณุฎ ุฅุนุฏุงุฏุงุช nginx
sudo cp server/nginx.conf /etc/nginx/sites-available/lms-app

# 2. ุชูุนูู ุงููููุน
sudo ln -s /etc/nginx/sites-available/lms-app /etc/nginx/sites-enabled/

# 3. ุงุฎุชุจุงุฑ ุงูุฅุนุฏุงุฏุงุช
sudo nginx -t

# 4. ุฅุนุงุฏุฉ ุชุดุบูู nginx
sudo systemctl reload nginx

# 5. ุฅุนุงุฏุฉ ุชุดุบูู Node.js
pm2 restart lms-server
```

### ุฃู ุงุณุชุฎุฏู ุงูุณูุฑูุจุช:
```bash
chmod +x server/fix-413-error.sh
./server/fix-413-error.sh
```

## ๐งช ุงุฎุชุจุงุฑ ุงูุญู

1. **ุฑูุน ุตูุฑุฉ ุตุบูุฑุฉ** (ุฃูู ูู 1MB) - ูุฌุจ ุฃู ูุนูู
2. **ุฑูุน ุตูุฑุฉ ูุจูุฑุฉ** (ุฃูุจุฑ ูู 1MB) - ูุฌุจ ุฃู ูุชู ุถุบุทูุง ุชููุงุฆูุงู
3. **ูุฑุงูุจุฉ ุงูู logs:**
   ```bash
   sudo tail -f /var/log/nginx/error.log
   pm2 logs lms-server
   ```

## ๐ ุงูุชุญุณููุงุช ุงููุถุงูุฉ

### ุถุบุท ุงูุตูุฑ ุงูุชููุงุฆู:
- ุงูุตูุฑ ุฃูุจุฑ ูู 1MB ูุชู ุถุบุทูุง ุชููุงุฆูุงู
- ุชูููู ุงูุฃุจุนุงุฏ ุฅูู 1920px ูุญุฏ ุฃูุตู
- ุถุบุท ุงูุฌูุฏุฉ ุฅูู 80%
- ุชูููู ุญุฌู ุงูููู ุจูุณุจุฉ 60-80%

### ุฅุนุฏุงุฏุงุช nginx ูุญุณูุฉ:
- ุฏุนู ูููุงุช ุญุชู 20MB
- timeout ุฃุทูู ููุฑูุน
- ุฅุนุฏุงุฏุงุช proxy ูุญุณูุฉ

### ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุญุณูุฉ:
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- timeout ุฃุทูู ููุฑูุน
- ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:

1. **ุชุญูู ูู ุฅุนุฏุงุฏุงุช nginx:**
   ```bash
   sudo nginx -t
   sudo systemctl status nginx
   ```

2. **ุชุญูู ูู logs:**
   ```bash
   sudo tail -f /var/log/nginx/error.log
   pm2 logs lms-server
   ```

3. **ุชุญูู ูู ุญุฏูุฏ ุงูุงุณุชุถุงูุฉ:**
   - ุจุนุถ ุงูุงุณุชุถุงูุงุช ููุง ุญุฏูุฏ ุนูู ุญุฌู ุงููููุงุช
   - ุชุญูู ูู ุฅุนุฏุงุฏุงุช PHP (ุฅุฐุง ูุงู ููุฌูุฏ)
   - ุชุญูู ูู ุฅุนุฏุงุฏุงุช Apache (ุฅุฐุง ูุงู ููุฌูุฏ)

4. **ุงุฎุชุจุงุฑ ุงูุงุชุตุงู:**
   ```bash
   curl -X POST -F "image=@test-image.jpg" http://localhost:5000/api/upload/image
   ```

## ๐ ููุงุญุธุงุช ูููุฉ

- **ุงูุถุบุท ุงูุชููุงุฆู** ูุนูู ููุท ููุตูุฑ ุฃูุจุฑ ูู 1MB
- **ุฅุนุฏุงุฏุงุช nginx** ุชุญุชุงุฌ ุตูุงุญูุงุช sudo
- **PM2** ูุทููุจ ูุฅุฏุงุฑุฉ Node.js ูู ุงูุฅูุชุงุฌ
- **HTTPS** ูุฏ ูุญุชุงุฌ ุฅุนุฏุงุฏุงุช ุฅุถุงููุฉ

## ๐ฏ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

ุจุนุฏ ุชุทุจูู ูุฐู ุงูุญููู:
- โ ุฑูุน ุงูุตูุฑ ุญุชู 10MB
- โ ุถุบุท ุชููุงุฆู ููุตูุฑ ุงููุจูุฑุฉ
- โ ุชุญุณูู ุงูุฃุฏุงุก
- โ ุชูููู ุงุณุชููุงู ุงููุทุงู ุงูุชุฑุฏุฏู
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู
